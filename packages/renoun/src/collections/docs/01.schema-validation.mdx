export const metadata = {
  title: 'Collection Schema Validation',
  label: 'Schema Validation',
  description: 'Learn how to add schema validation to collections in Renoun.',
}

In this guide, we'll walk through how to use [Zod](https://zod.dev/) and [Valibot](https://valibot.dev/) to add collection schemas. This ensures that your targeted files conform to an expected structure, providing type safety and validation.

## Before You Begin

Before you start, make sure you have a basic understanding of how collections work in Renoun. If you're new to collections, check out the [Collections Guide](/docs/collections). We'll also be using MDX files in this guide, so make sure you're familiar with the [MDX Guide](/docs/mdx) as well.

## Using Zod

Zod is a TypeScript-first schema validation library with static type inference. Let's look at how you can use Zod to add schema validation to your collections in Renoun.

### Install

First, install `zod` using your package manager:

<PackageInstall packages={['zod']} />

### Define Schema

Now, we'll create a schema using `zod` for the front matter of an MDX file:

```ts
import { z } from 'zod'

const frontmatterSchema = z.object({
  title: z.string(),
  date: z.coerce.date(),
  summary: z.string().optional(),
  tags: z.array(z.string()).optional(),
})
```

### Apply to Collection

We can now apply the Zod `frontmatterSchema` to your collection using the `schema` option in the `collection` utility:

```ts
import { collection } from 'renoun/collections'
import { z } from 'zod'

const frontmatterSchema = z.object({
  title: z.string(),
  date: z.coerce.date(),
  summary: z.string().optional(),
  tags: z.array(z.string()).optional(),
})

export const PostsCollection = collection<{
  default: MDXContent
  frontmatter: z.infer<typeof frontmatterSchema>
}>('posts/.mdx', {
  baseDirectory: 'posts',
  schema: {
    frontmatter: frontmatterSchema.parse,
  },
})
```

Now, the `frontmatter` field in your collection will be validated against the `frontmatterSchema` we defined using Zod. If the data does not match the schema, an error will be thrown.

## Using Valibot

Valibot is the open source schema library for TypeScript with bundle
size, type safety and developer experience in mind. Let's look at how you can use Valibot to add schema validation to your collections in Renoun.

### Install

First, install `valibot` using your package manager:

<PackageInstall packages={['valibot']} />

### Define Schema

Now, we'll create a schema using `valibot` for the front matter of an MDX file:

```ts
import * as v from 'valibot'

const frontmatterSchema = v.object({
  title: v.string(),
  date: v.pipe(v.unknown(), v.transform(Date)),
  summary: v.optional(v.string()),
  tags: v.optional(v.array(v.string())),
})
```

### Apply to Collection

We can now apply the Valibot `frontmatterSchema` to your collection using the `schema` option in the `collection` utility:

```ts
import { collection } from 'renoun/collections'
import * as v from 'valibot'

const frontmatterSchema = v.object({
  title: v.string(),
  date: v.pipe(v.unknown(), v.transform(Date)),
  summary: v.optional(v.string()),
  tags: v.optional(v.array(v.string())),
})

export const PostsCollection = collection<{
  default: MDXContent
  frontmatter: v.InferInput<typeof frontmatterSchema>
}>('posts/.mdx', {
  baseDirectory: 'posts',
  schema: {
    frontmatter: (value) => v.parse(frontmatterSchema, value),
  },
})
```

Now, the `frontmatter` field in your collection will be validated against the `frontmatterSchema` we defined using Valibot. If the data does not match the schema, an error will be thrown.

## Conclusion

By using `zod` or `valibot`, you can add robust schema validation to your collections in Renoun. This ensures that your data is always in the expected format, making your application more reliable and easier to maintain.

For more information, refer to the [zod documentation](https://github.com/colinhacks/zod) or the [valibot documentation](https://github.com/valibot/valibot).
